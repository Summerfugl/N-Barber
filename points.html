<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ï‡πâ‡∏° - N Barber Salon</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; color: #333; }
        .card { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); width: 100%; max-width: 400px; text-align: center; }
        .logo { width: 100px; display: block; margin: 0 auto 15px auto; border-radius: 10px; }
        
        /* Tabs Style */
        .tabs { display: flex; background: #e0e0e0; border-radius: 12px; padding: 5px; margin-bottom: 25px; }
        .tab { flex: 1; padding: 12px; cursor: pointer; border-radius: 10px; font-weight: 500; color: #666; transition: 0.3s; }
        .tab.active { background: white; color: #000; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        /* Sections */
        .form-section { display: none; }
        .form-section.active { display: block; animation: fade 0.3s; }
        @keyframes fade { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        h3 { margin-top: 0; font-weight: 500; color: #1d1d1f; }

        input { width: 100%; padding: 15px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 12px; box-sizing: border-box; font-size: 16px; font-family: 'Kanit', sans-serif; background-color: #fafafa; }
        input:focus { outline: none; border-color: #333; background-color: #fff; }
        
        /* Buttons */
        button { width: 100%; padding: 15px; border: none; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: bold; color: white; transition: 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn-add { background-color: #2c3e50; } 
        .btn-redeem { background-color: #c0392b; } 
        button:hover { opacity: 0.9; transform: translateY(-2px); }
        button:disabled { background-color: #ccc; transform: none; box-shadow: none; cursor: not-allowed; }

        /* Result Box */
        #result { margin-top: 25px; padding: 20px; border-radius: 12px; display: none; }
        .success { background-color: #e8f5e9; color: #1b5e20; border: 1px solid #c8e6c9; }
        .error { background-color: #ffebee; color: #b71c1c; border: 1px solid #ffcdd2; }
        
        .total-points { font-size: 42px; font-weight: bold; margin-top: 10px; display: block; color: #1d1d1f; }
        .note { font-size: 13px; color: #888; margin-bottom: 15px; text-align: right; }
    </style>
</head>
<body>

<div class="card">
    <img src="IMG_5525.png" alt="Logo" class="logo">
    
    <div class="tabs">
        <div id="tabAdd" class="tab active" onclick="showPage('add')">‡∏™‡∏∞‡∏™‡∏°‡πÅ‡∏ï‡πâ‡∏°</div>
        <div id="tabRedeem" class="tab" onclick="showPage('redeem')">‡πÅ‡∏•‡∏Å‡πÅ‡∏ï‡πâ‡∏°</div>
    </div>

    <div id="pageAdd" class="form-section active">
        <h3>‡∏™‡∏∞‡∏™‡∏°‡πÅ‡∏ï‡πâ‡∏° (Add)</h3>
        <input type="text" id="addID" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (Member ID)">
        <input type="number" id="addAmount" placeholder="‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)">
        <div class="note">* 50 ‡∏ö‡∏≤‡∏ó = 1 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
        <button type="button" onclick="sendAdd()" class="btn-add" id="btnAdd">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ï‡πâ‡∏°</button>
    </div>

    <div id="pageRedeem" class="form-section">
        <h3>‡πÅ‡∏•‡∏Å‡πÅ‡∏ï‡πâ‡∏° (Redeem)</h3>
        <input type="text" id="redeemID" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (Member ID)">
        <input type="number" id="redeemAmount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ï‡πâ‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ï‡∏±‡∏î">
        <div class="note">‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ï‡πâ‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</div>
        <button type="button" onclick="sendRedeem()" class="btn-redeem" id="btnRedeem">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡πÅ‡∏ï‡πâ‡∏°</button>
    </div>

    <div id="result"></div>
</div>

<script>
    // =============================================
    // üî¥ ‡∏ß‡∏≤‡∏á URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Google Apps Script ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà üî¥
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzo7PsqNe-vQKR-UKoofu4RIGZgdzNYXZhbfSjEA3bfeh3F6544cVKPKZa02L-LT8Zoow/exec'; 
    // =============================================

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ (‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö‡πÅ‡∏¢‡∏Å‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô)
    function showPage(page) {
        // ‡∏ã‡πà‡∏≠‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏Å‡πà‡∏≤
        document.getElementById('result').style.display = 'none';
        
        if (page === 'add') {
            // ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ Add
            document.getElementById('pageAdd').classList.add('active');
            document.getElementById('pageRedeem').classList.remove('active');
            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏° Tab
            document.getElementById('tabAdd').classList.add('active');
            document.getElementById('tabRedeem').classList.remove('active');
        } else {
            // ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ Redeem
            document.getElementById('pageRedeem').classList.add('active');
            document.getElementById('pageAdd').classList.remove('active');
            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏° Tab
            document.getElementById('tabRedeem').classList.add('active');
            document.getElementById('tabAdd').classList.remove('active');
        }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• "‡∏™‡∏∞‡∏™‡∏°‡πÅ‡∏ï‡πâ‡∏°"
    async function sendAdd() {
        const id = document.getElementById('addID').value.trim();
        const amount = document.getElementById('addAmount').value.trim();

        if(!id || !amount) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");

        callScript('updatePoints', 'add', id, amount, 'btnAdd');
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• "‡πÅ‡∏•‡∏Å‡πÅ‡∏ï‡πâ‡∏°" (‡πÅ‡∏¢‡∏Å‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ö‡∏±‡πä‡∏Å)
    async function sendRedeem() {
        const id = document.getElementById('redeemID').value.trim();
        const amount = document.getElementById('redeemAmount').value.trim();

        if(!id || !amount) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");

        callScript('updatePoints', 'redeem', id, amount, 'btnRedeem');
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Script
    async function callScript(action, mode, id, amount, btnID) {
        const btn = document.getElementById(btnID);
        const resultDiv = document.getElementById('result');

        // ‡∏•‡πá‡∏≠‡∏Å‡∏õ‡∏∏‡πà‡∏°
        btn.disabled = true;
        const oldText = btn.innerText;
        btn.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...';
        resultDiv.style.display = 'none';

        try {
            const response = await fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({
                    action: action,
                    mode: mode,
                    memberID: id,
                    amount: amount
                })
            });
            const data = await response.json();

            // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            resultDiv.style.display = 'block';
            if(data.result === 'success') {
                resultDiv.className = 'success';
                resultDiv.innerHTML = `‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!<br>${data.message}<br>‡πÅ‡∏ï‡πâ‡∏°‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: <span class="total-points">${data.totalPoints}</span>`;
                
                // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô/‡πÅ‡∏ï‡πâ‡∏°
                if(mode === 'add') document.getElementById('addAmount').value = '';
                else document.getElementById('redeemAmount').value = '';

            } else {
                resultDiv.className = 'error';
                resultDiv.innerHTML = `‚ö†Ô∏è ‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î<br>${data.message}`;
            }

        } catch (error) {
            alert('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡πá‡∏Å URL ‡∏´‡∏£‡∏∑‡∏≠ ‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï');
            console.error(error);
        } finally {
            // ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏õ‡∏∏‡πà‡∏°
            btn.disabled = false;
            btn.innerText = oldText;
        }
    }
</script>

</body>
</html>